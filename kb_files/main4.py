import board
from kb import KMKKeyboard, isRight
from kmk.keys import KC
from kmk.modules.layers import Layers
from kmk.modules.split import Split, SplitSide, SplitType
from kmk.extensions.media_keys import MediaKeys
from kmk.modules.tapdance import TapDance
from kmk.modules.holdtap import HoldTap
from kmk.modules.combos import Combos, Chord
from kmk.modules.sticky_keys import StickyKeys
from kmk.modules.sticky_mod import StickyMod
from kmk.modules.macros import Macros, Press, Release, Tap

print(f"LOADING PIANTOR {'RIGHT' if isRight else 'LEFT'}...")

'''

I N I T I A L I Z E  K E E B
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
keyboard = KMKKeyboard()
keyboard.tap_time = 100
keyboard.extensions.append(MediaKeys())
'''

S P L I T  S E T U P
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
split_side = SplitSide.RIGHT if isRight else SplitSide.LEFT
uart_flip = False if isRight else True

data_pin = board.GP1  #RX
data_pin2 = board.GP0 #TX

split = Split(
    split_flip=False,
    split_side=split_side,
    split_type=SplitType.UART,
    split_target_left=True,
    data_pin=data_pin,
    data_pin2=data_pin2,
    uart_flip=uart_flip,
    use_pio=True
)
keyboard.modules.append(split)

'''
C L E A N  K E Y  N A M E S
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
XXXXXXX = KC.NO
_______ = KC.TRNS
KC_MEH  = KC.LCTRL(KC.LSFT(KC.LALT))

'''
S T I C K Y  K E Y S
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
sticky_keys = StickyKeys()
sticky_keys = StickyKeys(release_after=2000)
keyboard.modules.append(sticky_keys)

SK_LCTL = KC.SK(KC.LCTL)
SK_LSFT = KC.SK(KC.LSFT)
SK_LALT = KC.SK(KC.LALT)
SK_LGUI = KC.SK(KC.LGUI)

SK_MEH  = KC.SK(KC.LCTRL(KC.LSFT(KC.LALT)))

'''
L A Y E R S
‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
layers = Layers()
keyboard.modules.append(layers)

LAY_0 = KC.TO(0) # BASE
LAY_1 = KC.MO(1) # NUMS
LAY_2 = KC.MO(2) # NAV
LAY_3 = KC.MO(3) # SYM
LAY_4 = KC.MO(4) # FUNC

LT_B_1      = KC.LT(1, KC.B,    prefer_hold=False, tap_interrupted=False, tap_time=100)
LT_SPC_2    = KC.LT(2, KC.SPC,  prefer_hold=False, tap_interrupted=False, tap_time=120)
LT_SKMEH_3  = KC.LT(3, SK_MEH,  prefer_hold=False, tap_interrupted=False, tap_time=100)
LT_Z_3      = KC.LT(3, KC.Z,    prefer_hold=False, tap_interrupted=False, tap_time=110)

'''
H O L D  T A P
‾‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
holdtap = HoldTap()
keyboard.modules.append(holdtap)
HT_G_OPT     = KC.HT(KC.G, KC.LALT,  prefer_hold=False, tap_interrupted=False, tap_time=100)

'''
T A P  D A N C E
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
# tapdance = TapDance()
# tapdance.tap_time = 180
# keyboard.modules.append(tapdance)

'''
C O M B O S

‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
combos = Combos()
keyboard.modules.append(combos)
combos.combos = [
    Chord((KC.LSFT, LAY_3), SK_MEH, timeout=90),     # LSHFT + LAY_3         = SK_MEH
    Chord((KC.Q, KC.W), KC.ESCAPE, timeout=50),     # Q + W         = ESCAPE
    Chord((KC.V, LT_B_1), KC.BSPC, timeout=50),     # V + B         = BACKSPACE
    #Chord((KC.I, KC.K), KC.BSPC, timeout=50),       # I + K         = BACKSPACE
    #Chord((KC.O, KC.L), KC.DEL, timeout=50),        # O + L         = DELETE
    Chord((KC.D, KC.F), KC.SPC),                    # D + F         = SPACE
    Chord((KC.F, HT_G_OPT), KC.ENT, timeout=50),    # F + G         = ENTER
    Chord((KC.R, KC.T), KC.TAB, timeout=50),        # R + T         = TAB
]

'''
M A C R O S
‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
macros = Macros()
keyboard.modules.append(macros)

M_TAP = KC.MACRO(
    Tap(KC.RGHT),
    Press(KC.LGUI),
    Tap(KC.V),
    Release(KC.LGUI),
    Tap(KC.TAB)
)

'''
K E Y M A P
‾‾‾‾‾‾‾‾‾‾‾‾‾
'''
keyboard.keymap = [
    # LAYER 0 - BASE #########################################################################################################################################
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │    Q    │    W    │    E    │    R    │    T    │                           │    Y    │    U    │    I    │    O    │    P    │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │    A    │    S    │    D    │    F    │    G    │                           │    H    │    J    │    K    │    L    │    ;    │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │ LT_Z_3  │    X    │    C    │    V    │  LT_B_1 │                           │    N    │    M    │    ,    │    .    │    /    │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #                                           ┌─────────┬─────────┬─────────┐       ┌─────────┬─────────┬─────────┐
    #                                           │  LAY_4  │  LAY_1  │  LSHFT  │       │  KC.SPC │  LAY_2  │  QUOT   │
    #                                           └─────────┴─────────┴─────────┘       └─────────┴─────────┴─────────┘
    [
        _______, KC.Q,    KC.W,    KC.E,    KC.R,    KC.T,                                              KC.Y,    KC.U,    KC.I,    KC.O,    KC.P,    _______,
        _______, KC.A,    KC.S,    KC.D,    KC.F,    HT_G_OPT,                                          KC.H,    KC.J,    KC.K,    KC.L,    KC.SCLN, _______,
        _______, LT_Z_3,  KC.X,    KC.C,    KC.V,    LT_B_1,                                            KC.N,    KC.M,    KC.COMM, KC.DOT,  KC.SLSH, _______,
        LAY_4,   KC.LSFT, KC.LGUI,                           LT_SPC_2, LAY_3,   KC.QUOT,
    ],
    # LAYER 1 - EMPTY ########################################################################################################################################
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │    1    │    2    │    3    │    4    │    5    │                           │    6    │    7    │    8    │    9    │    0    │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │    !    │    @    │    #    │    $    │    %    │                           │    ^    │    &    │    *    │    `    │    \    │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #                                           ┌─────────┬─────────┬─────────┐       ┌─────────┬─────────┬─────────┐
    #                                           │         │         │         │       │         │         │         │
    #                                           └─────────┴─────────┴─────────┘       └─────────┴─────────┴─────────┘
    [
        _______, KC.N1,   KC.N2,   KC.N3,   KC.N4,   KC.N5,                                             KC.N6,   KC.N7,   KC.N8,   KC.N9,   KC.N0,   _______,
        _______, KC.EXLM, KC.AT,   KC.HASH, KC.DLR,  KC.PERC,                                           KC.CIRC, KC.AMPR, KC.ASTR, KC.GRV,  KC.BSLS, _______,
        _______, _______, _______, _______, _______, _______,                                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______,                         _______, _______, _______,
    ],
    # LAYER 2 - NAV ########################################################################################################################################
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │   ESC   │         │         │         │   TAB   │                           │         │         │  BSPCE  │   DEL   │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │  ENTER  │  LEFT   │  DOWN   │   UP    │  DOWN   │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │ PGE DWN │ PGE UP  │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #                                           ┌─────────┬─────────┬─────────┐       ┌─────────┬─────────┬─────────┐
    #                                           │  LCTRL  │         │         │       │         │         │         │
    #                                           └─────────┴─────────┴─────────┘       └─────────┴─────────┴─────────┘
    [
        _______, KC.ESC,  _______, _______, _______, KC.TAB,                                         _______, _______,  KC.BSPC, KC.DEL,  _______, _______,
        _______, _______, _______, _______, _______, _______,                                        KC.ENT,  KC.LEFT,  KC.DOWN, KC.UP,   KC.RGHT, _______,
        _______, _______, _______, _______, _______, _______,                                        _______, _______,   KC.PGDN, KC.PGUP, _______, _______,
        KC.LCTRL, _______, _______,                      _______, _______, _______,
    ],
    # LAYER 3 - (SYMBOLS) ###########################################################################################################################
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │    (    │    <    │                           │    >    │    )    │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │    {    │    [    │                           │    ]    │    }    │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │    _    │    -    │                           │    =    │    +    │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #                                           ┌─────────┬─────────┬─────────┐       ┌─────────┬─────────┬─────────┐
    #                                           │         │         │         │       │         │         │         │
    #                                           └─────────┴─────────┴─────────┘       └─────────┴─────────┴─────────┘
    [
        _______, _______, _______, _______, KC.LPRN, KC.LABK,                                           KC.RABK, KC.RPRN, _______, _______, _______, _______,
        _______, _______, _______, _______, KC.LCBR, KC.LBRC,                                           KC.RBRC, KC.RCBR, _______, _______, _______, _______,
        _______, _______, _______, _______, KC.UNDS, KC.MINS,                                           KC.EQL,  KC.PLUS, _______, _______, _______, _______,
        _______, _______, _______,                         _______, _______, _______,
    ],
    # LAYER 4 - FUNC ########################################################################################################################################
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #                                           ┌─────────┬─────────┬─────────┐       ┌─────────┬─────────┬─────────┐
    #                                           │         │         │         │       │         │         │         │
    #                                           └─────────┴─────────┴─────────┘       └─────────┴─────────┴─────────┘
    [
        _______, KC.F1,   KC.F2,   KC.F3,   KC.F4,   KC.F5,                                             KC.F6,   KC.F7,   KC.F8,   KC.F9,   KC.F10,  _______,
        _______, _______, _______, _______, M_TAP,   KC.F11,                                            KC.F12,  _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                                           _______, _______, KC.MRWD, KC.MPLY, KC.MFFD, _______,
        _______, _______, _______,                         _______, _______, _______,
    ],
    # LAYER 4 - TRANS ########################################################################################################################################
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │         │         │         │         │         │         │                           │         │         │         │         │         │         │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #                                           ┌─────────┬─────────┬─────────┐       ┌─────────┬─────────┬─────────┐
    #                                           │         │         │         │       │         │         │         │
    #                                           └─────────┴─────────┴─────────┘       └─────────┴─────────┴─────────┘
    [
        _______, _______, _______, _______, _______, _______,                                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______,                         _______, _______, _______,
    ],
    # LAYER 5 - EMPTY ########################################################################################################################################
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │                           │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │                           │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #   ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐                           ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
    #   │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │                           │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │  KC.NO  │
    #   └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘                           └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
    #                                           ┌─────────┬─────────┬─────────┐       ┌─────────┬─────────┬─────────┐
    #                                           │  KC.NO  │  KC.NO  │  KC.NO  │       │  KC.NO  │  KC.NO  │  KC.NO  │
    #                                           └─────────┴─────────┴─────────┘       └─────────┴─────────┴─────────┘
    [
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                                           XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                                           XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                                           XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
        XXXXXXX, XXXXXXX, XXXXXXX,                         XXXXXXX, XXXXXXX, XXXXXXX,
    ]
]

if __name__ == '__main__':
    keyboard.go()
